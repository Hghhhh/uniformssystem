<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.yidong.mapper.GoodsMapper" >
  <resultMap id="Goods" type="Goods" >
    <id column="id" property="goodsId" jdbcType="INTEGER" />
    <result column="name" property="goodsName" jdbcType="VARCHAR" />
    <result column="detail" property="detail" jdbcType="VARCHAR" />
    <collection property="goodsPicture" javaType="ArrayList" ofType="java.lang.String"
                column="id" select="selectPicture"></collection>
    <collection property="priceList" javaType="ArrayList" ofType="Price"
                column="id" select="com.yidong.mapper.PriceMapper.selectPrice"></collection>
  </resultMap>
  <resultMap id="DetailGoods" type="Goods" >
    <id column="id" property="goodsId" jdbcType="INTEGER" />
    <result column="name" property="goodsName" jdbcType="VARCHAR" />
    <result column="detail" property="detail" jdbcType="VARCHAR" />
    <result column="state" property="state" />
    <collection property="goodsPicture" javaType="ArrayList" ofType="java.lang.String"
                column="id" select="selectPicture"></collection>
    <collection property="priceList" javaType="ArrayList" ofType="Price"
                column="id" select="com.yidong.mapper.PriceMapper.selectPriceForGoodsDetail"></collection>
  </resultMap>
  <resultMap id="VipGoods" type="VipGoods" >
    <id column="id" property="goodsId" jdbcType="INTEGER" />
    <result column="name" property="goodsName" jdbcType="VARCHAR" />
    <result column="detail" property="detail" jdbcType="VARCHAR" />
    <result column="integral" property="integral" jdbcType="FLOAT"/>
    <result column="batch" property="batch" jdbcType="INTEGER" />
    <result column="state" property="state" />
    <association property="allRetail" column="id" select="selectAllRetail">
    </association>
    <association property="monthRetail" column="id" select="selectMonthRetail">
    </association>
    <collection property="goodsPicture" javaType="ArrayList" ofType="java.lang.String"
                column="id" select="selectPicture"></collection>
    <collection property="priceList" javaType="ArrayList" ofType="Price"
                column="id" select="com.yidong.mapper.PriceMapper.selectPriceForVip"></collection>
  </resultMap>
  <resultMap id="GoodsInfoMap" type="GoodsInfo" >
    <id column="id" property="goodsId" jdbcType="INTEGER" />
    <result column="name" property="goodsName" jdbcType="VARCHAR" />
    <result column="batch" property="batch" />
    <result column="state" property="state"/>
    <association property="goodsPicture" column="id" select="selectShoppingcarGoodsPicture">
    </association>
  </resultMap>
  <resultMap id="GiftInfoMap" type="GiftInfo" >
    <id column="id" property="goodsId" jdbcType="INTEGER" />
    <result column="name" property="goodsName" jdbcType="VARCHAR" />
    <association property="goodsPicture" column="id" select="selectShoppingcarGoodsPicture">
    </association>
  </resultMap>

  <select id="selectRecommendGoods" resultMap="Goods" parameterType="java.lang.Integer">
    SELECT id,name,detail from tb_goods where state!=3 and recommend=1
    <if test="num!=0">
      limit #{num}
    </if>
  </select>
  <select id="selectShoppingcarGoodsPicture" resultType="java.lang.String">
    SELECT imgAddress from tb_goods_picture where goodsId=#{id} group by goodsId
  </select>
  <select id="selectAllRetail" resultType="java.lang.String">
    SELECT sum(num) from tb_retail where goodsId=#{id}
  </select>
  <select id="selectMonthRetail" resultType="java.lang.String">
    SELECT sum(num) from tb_retail where goodsId=#{id} and DATE_FORMAT(time,'%Y%m')=DATE_FORMAT(CURDATE(),'%Y%m')
  </select>
  <select id="selectPicture" resultType="java.lang.String" >
    SELECT imgAddress from tb_goods_picture where goodsId=#{id}
  </select>
  <select id="selectGoods" resultMap="Goods">
    SELECT id,name,detail from tb_goods where state!=3;
  </select>
  <select id="selectGoodsByName" resultMap="Goods" parameterType="java.lang.String">
    SELECT id,name,detail from tb_goods where state!=3 and name like '%${name}%';
  </select>
  <select id="selectSingleGoods" resultMap="DetailGoods">
    SELECT id,name,detail,state from tb_goods where state!=3 and id=#{goodsId};
  </select>
  <select id="selectSingleVipGoods" resultMap="VipGoods">
    SELECT id,name,detail,batch,state from tb_goods where id=#{goodsId} and state!=3;
  </select>
  <select id="selectVipGoods" resultMap="VipGoods" >
    SELECT id,name,detail,batch from tb_goods where state!=3;
  </select>
  <select id="selectGoodsInfo" resultMap="GoodsInfoMap" parameterType="java.lang.Integer">
    SELECT id,name,batch,state from tb_goods where id=#{goodsId}
  </select>
  <select id="selectGoodsName" resultType="java.lang.String">
    SELECT name from tb_goods where id=#{goodsId}
  </select>

  <select id="selectGoodsBySmallTypeId" resultMap="Goods">
      SELECT id,name,detail from tb_goods where state!=3 and smallTypeId=#{smallTypeId};
  </select>

  <select id="selectGoodsByBigTypeId" resultMap="Goods">
    SELECT id,name,detail from tb_goods where state!=3 and bigTypeId=#{bigTypeId};
  </select>
  
  <select id="selectRetailHot" resultType="GoodsHot">
  SELECT  SUM(num) AS saleNum,tb_retail.goodsId FROM tb_retail GROUP BY tb_retail.goodsId HAVING EXISTS (SELECT id FROM tb_goods WHERE id=tb_retail.goodsId AND state!=3)
  </select>

  <select id="selectWholeHot" resultType="GoodsHot">
    SELECT  SUM(num) AS saleNum,goodsId FROM tb_wholesale GROUP BY goodsId  HAVING EXISTS (SELECT id FROM tb_goods WHERE id=goodsId AND state!=3)
  </select>

  <select id="selectGiftInfo" resultMap="GiftInfoMap" parameterType="java.lang.Integer">
    SELECT id,name from tb_goods where id=#{giftId}
  </select>


  <select id="selectGoodsState" resultType="java.lang.Integer">
    SELECT state from tb_goods where id=#{id}
  </select>


  <select id="selectGoodsPrice" resultType="PriceAndTradePrice" parameterType="map">
    SELECT price,tradePrice from tb_goods_price where id=#{priceId} and goodsId=#{goodsId}
  </select>

</mapper>